<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadrotor Control Lab — 6-DOF Flight Dynamics Simulator</title>
    <meta name="description" content="Interactive 6-DOF quadrotor simulator comparing PID, Sliding Mode, Super-Twisting SMC, and Model Predictive Control architectures.">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>

<div class="app-layout">

    <!-- ============================================================
         3D VIEWPORT
         ============================================================ -->
    <div id="viewport">
        <div id="telemetry-overlay">
            <div class="tel-title">Flight Telemetry</div>
            <div class="tel-row">
                <span class="tel-label">T</span>
                <span class="tel-val" id="tel-time">0.0</span>s
            </div>
            <div class="tel-row">
                <span class="tel-label">ALT</span>
                <span class="tel-val" id="tel-alt">0.00</span>m
            </div>
            <div class="tel-row">
                <span class="tel-label">X</span>
                <span class="tel-val" id="tel-x">0.00</span>
                <span class="tel-label" style="margin-left:8px">Z</span>
                <span class="tel-val" id="tel-z">0.00</span>
            </div>
            <div class="tel-row">
                <span class="tel-label">Vx</span>
                <span class="tel-val" id="tel-vx">0.00</span>
                <span class="tel-label" style="margin-left:4px">Vy</span>
                <span class="tel-val" id="tel-vy">0.00</span>
                <span class="tel-label" style="margin-left:4px">Vz</span>
                <span class="tel-val" id="tel-vz">0.00</span>
            </div>
            <div class="tel-row">
                <span class="tel-label">φ</span>
                <span class="tel-val" id="tel-phi">0.0°</span>
                <span class="tel-label" style="margin-left:4px">θ</span>
                <span class="tel-val" id="tel-theta">0.0°</span>
                <span class="tel-label" style="margin-left:4px">ψ</span>
                <span class="tel-val" id="tel-psi">0.0°</span>
            </div>
            <div class="tel-row">
                <span class="tel-label">‖e‖</span>
                <span class="tel-val warn" id="tel-err">0.000</span>
                <span class="tel-label" style="margin-left:8px">T</span>
                <span class="tel-val" id="tel-thrust">0.00</span>N
            </div>
            <div class="tel-row">
                <span id="rec-indicator">● REC</span>
            </div>
        </div>
    </div>

    <!-- ============================================================
         SIDEBAR
         ============================================================ -->
    <div id="sidebar">

        <div class="sidebar-header">
            <h1>⬡ Quadrotor Control Lab</h1>
            <div class="subtitle">6-DOF Nonlinear Flight Dynamics &amp; Control</div>
        </div>

        <!-- Controller Selection -->
        <div class="card">
            <div class="card-header">
                <h2>Control Architecture</h2>
                <span class="tag">outer + inner loop</span>
            </div>
            <select id="algo-select">
                <option value="PID">Cascaded PID (Proportional-Integral-Derivative)</option>
                <option value="SMC">Sliding Mode Control (Standard)</option>
                <option value="STS">Super-Twisting SMC (2nd Order)</option>
                <option value="MPC">Model Predictive Control (Receding Horizon)</option>
            </select>
            <div class="info-text" id="controller-info"></div>
        </div>

        <!-- Trajectory Selection -->
        <div class="card">
            <div class="card-header">
                <h2>Reference Trajectory</h2>
            </div>
            <select id="pattern-select">
                <option value="HOVER">Hover (Fixed Setpoint)</option>
                <option value="STEP">Step Response</option>
                <option value="CIRCLE">Horizontal Circle</option>
                <option value="HELIX">Ascending Helix</option>
                <option value="FIGURE8">Lemniscate (Figure-8)</option>
                <option value="SQUARE">Waypoint Square</option>
                <option value="CUSTOM">Custom Waypoints</option>
                <option value="KEYBOARD">Manual (Keyboard)</option>
            </select>
            <div class="info-text" id="trajectory-info"></div>

            <!-- Keyboard hints (hidden by default) -->
            <div id="keyboard-hint">
                <span class="key-badge">W</span><span class="key-badge">A</span><span class="key-badge">S</span><span class="key-badge">D</span> Move XZ &nbsp;
                <span class="key-badge">Space</span> Up &nbsp;
                <span class="key-badge">Shift</span> Down &nbsp;
                <span class="key-badge">Q</span><span class="key-badge">E</span> Yaw
            </div>

            <!-- Custom waypoints (hidden by default) -->
            <div id="custom-wp-panel">
                <div class="wp-input-row">
                    <label>X</label><input type="number" id="wp-x" value="3" step="0.5">
                    <label>Y</label><input type="number" id="wp-y" value="3" step="0.5">
                    <label>Z</label><input type="number" id="wp-z" value="0" step="0.5">
                    <button class="btn" id="btn-add-wp" style="flex:none;padding:5px 8px">+ Add</button>
                </div>
                <div id="wp-list"></div>
                <button class="btn danger" id="btn-clear-wp" style="margin-top:6px;width:100%">Clear All Waypoints</button>
            </div>
        </div>

        <!-- Gains Panel -->
        <div class="card">
            <div class="card-header">
                <h2>Gain Tuning</h2>
                <span class="tag" id="gain-algo-tag">PID</span>
            </div>
            <div id="gains-panel"></div>
        </div>

        <!-- Environment -->
        <div class="card">
            <div class="card-header">
                <h2>Environment</h2>
            </div>
            <div class="env-row">
                <span class="env-label">Wind disturbance</span>
                <span class="env-value" id="wind-value">0.0 m/s</span>
            </div>
            <input type="range" id="wind-slider" min="0" max="8" step="0.1" value="0" style="width:100%">
            <div class="env-row" style="margin-top:6px">
                <span class="env-label">Simulation speed</span>
                <span class="env-value" id="speed-value">1.0×</span>
            </div>
            <input type="range" id="speed-slider" min="0.25" max="4" step="0.25" value="1" style="width:100%">
        </div>

        <!-- Simulation Controls -->
        <div class="card">
            <div class="card-header">
                <h2>Controls</h2>
            </div>
            <div class="btn-group">
                <button class="btn danger" id="btn-reset">↺ Reset</button>
                <button class="btn" id="btn-pause">❚❚ Pause</button>
                <button class="btn" id="btn-record">⏺ Record</button>
            </div>
            <div class="btn-group" style="margin-top:6px">
                <button class="btn" id="btn-export">↓ Export CSV (Full)</button>
                <button class="btn" id="btn-export-chart">↓ Export Charts</button>
            </div>
        </div>

        <!-- Charts -->
        <div class="card">
            <div class="card-header">
                <h2>Position Tracking</h2>
                <span class="tag">desired vs actual</span>
            </div>
            <div class="chart-container">
                <canvas id="chart-position"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>Error &amp; Sliding Surface</h2>
            </div>
            <div class="chart-container">
                <canvas id="chart-error"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>Control Effort</h2>
                <span class="tag">thrust &amp; torques</span>
            </div>
            <div class="chart-container">
                <canvas id="chart-control"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>Phase Portrait</h2>
                <span class="tag">altitude error vs velocity</span>
            </div>
            <div class="chart-container">
                <canvas id="chart-phase"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>Motor Speeds</h2>
                <span class="tag">rad/s</span>
            </div>
            <div class="chart-container">
                <canvas id="chart-motors"></canvas>
            </div>
        </div>

        <!-- Footer / Credits -->
        <div style="padding: 12px 18px; font-size: 0.62rem; color: var(--text-dim); text-align: center; border-top: 1px solid var(--border); margin-top: auto;">
            Quadrotor Control Lab &mdash; 6-DOF Rigid Body Dynamics with RK4 Integration<br>
            Cascaded position/attitude control architecture &bull; X-frame motor mixing
        </div>
    </div>

</div>

<!-- Scripts (load order matters — no modules for GitHub Pages compatibility) -->
<script src="js/physics.js"></script>
<script src="js/controllers.js"></script>
<script src="js/trajectories.js"></script>
<script src="js/drone3d.js"></script>
<script src="js/charts.js"></script>
<script src="js/keyboard.js"></script>
<script src="js/dataLogger.js"></script>
<script src="js/app.js"></script>

</body>
</html>
